<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JITimer - Jejum Intermitente</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (para JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Anima√ß√µes customizadas que o Tailwind padr√£o pode n√£o ter completas */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-in.fade-in { animation: fadeIn 0.2s ease-out forwards; }
        .animate-in.slide-in-from-bottom { animation: slideUp 0.3s ease-out forwards; }
        
        /* Ajuste para input de data/hora no dark mode */
        input[type="date"], input[type="time"] {
            color-scheme: dark;
        }
    </style>
</head>
<body class="bg-neutral-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON COMPONENTS (Substituindo lucide-react para evitar depend√™ncias externas complexas) ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Play = (props) => <Icon {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></Icon>;
        const Square = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></Icon>;
        const Edit2 = (props) => <Icon {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></Icon>;
        const HistoryIcon = (props) => <Icon {...props}><path d="M3 3v5h5"></path><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path><path d="M12 7v5l4 2"></path></Icon>;
        const ChevronRight = (props) => <Icon {...props}><path d="m9 18 6-6-6-6"></path></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></Icon>;
        const Check = (props) => <Icon {...props}><path d="M20 6 9 17l-5-5"></path></Icon>;
        const Clock = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const Calendar = (props) => <Icon {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></Icon>;
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></Icon>;

        // --- UTILS & HELPERS ---
        const formatTime = (date) => {
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        };

        const formatDate = (date) => {
            return date.toLocaleDateString('pt-BR');
        };

        const formatDateForInput = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const formatDuration = (seconds) => {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        };

        const calculateProgress = (elapsed, goal) => {
            if (goal <= 0) return 0;
            return Math.min((elapsed / goal) * 100, 100);
        };

        // --- COMPONENTS ---
        const CircularProgress = ({ size = 280, strokeWidth = 12, progress, children, isActive }) => {
            const center = size / 2;
            const radius = center - strokeWidth;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progress / 100) * circumference;

            return (
                <div className="relative flex items-center justify-center" style={{ width: size, height: size }}>
                    <svg className="transform -rotate-90 w-full h-full">
                        <circle
                            className="text-neutral-800"
                            stroke="currentColor"
                            strokeWidth={strokeWidth}
                            fill="transparent"
                            r={radius}
                            cx={center}
                            cy={center}
                        />
                        <circle
                            className={`${isActive ? 'text-green-500' : 'text-orange-500'} transition-all duration-1000 ease-out`}
                            stroke="currentColor"
                            strokeWidth={strokeWidth}
                            strokeDasharray={circumference}
                            strokeDashoffset={offset}
                            strokeLinecap="round"
                            fill="transparent"
                            r={radius}
                            cx={center}
                            cy={center}
                            style={{
                                filter: isActive ? 'drop-shadow(0 0 6px rgba(74, 222, 128, 0.5))' : 'none'
                            }}
                        />
                        {progress > 0 && progress < 100 && (
                            <circle 
                                className={isActive ? 'text-white' : 'text-orange-200'}
                                fill="currentColor"
                                r={strokeWidth * 0.6}
                                cx={center + radius * Math.cos(2 * Math.PI * (progress / 100) - Math.PI / 2)}
                                cy={center + radius * Math.sin(2 * Math.PI * (progress / 100) - Math.PI / 2)}
                            />
                        )}
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        {children}
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        function JITimer() {
            // State
            const [isFasting, setIsFasting] = useState(false);
            const [startTime, setStartTime] = useState(null);
            const [endTime, setEndTime] = useState(null);
            const [elapsed, setElapsed] = useState(0);
            const [history, setHistory] = useState([]);
            
            // Settings State
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [targetHours, setTargetHours] = useState(18); // Default 18h
            const [protocolLabel, setProtocolLabel] = useState('18:6');

            // Edit Time State (Reused for Start and End)
            const [isEditTimeOpen, setIsEditTimeOpen] = useState(false);
            const [editMode, setEditMode] = useState('start'); // 'start' | 'end'
            const [editTimeValue, setEditTimeValue] = useState('');
            const [editDateValue, setEditDateValue] = useState('');

            // History Modal State
            const [isHistoryOpen, setIsHistoryOpen] = useState(false);

            // File Input Ref for Import
            const fileInputRef = useRef(null);

            // Derived
            const goalSeconds = targetHours * 3600;

            // Refs for interval
            const timerRef = useRef(null);

            // Load from local storage on mount
            useEffect(() => {
                const savedState = localStorage.getItem('jitimer_state');
                const savedConfig = localStorage.getItem('jitimer_config');
                const savedHistory = localStorage.getItem('jitimer_history');

                // Load History
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }

                // Load Config first
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    if (config.targetHours) setTargetHours(config.targetHours);
                    if (config.protocolLabel) setProtocolLabel(config.protocolLabel);
                }

                // Load Timer State
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    if (parsed.isFasting && parsed.startTime) {
                        setIsFasting(true);
                        const start = new Date(parsed.startTime);
                        setStartTime(start);
                        
                        // Recalculate goal seconds based on potentially loaded config or default
                        const currentTarget = savedConfig ? JSON.parse(savedConfig).targetHours : 18;
                        const currentGoalSeconds = currentTarget * 3600;

                        const end = new Date(start.getTime() + currentGoalSeconds * 1000);
                        setEndTime(end);

                        // Update elapsed immediately
                        const now = new Date();
                        const diff = Math.floor((now.getTime() - start.getTime()) / 1000);
                        setElapsed(diff);
                    }
                }
            }, []);

            // Timer Logic
            useEffect(() => {
                if (isFasting && startTime) {
                    timerRef.current = setInterval(() => {
                        const now = new Date();
                        const diff = Math.floor((now.getTime() - startTime.getTime()) / 1000);
                        setElapsed(diff);
                    }, 1000);
                } else {
                    if (timerRef.current) clearInterval(timerRef.current);
                }

                return () => {
                    if (timerRef.current) clearInterval(timerRef.current);
                };
            }, [isFasting, startTime]);

            // Persist State (Timer)
            useEffect(() => {
                if (isFasting && startTime) {
                    localStorage.setItem('jitimer_state', JSON.stringify({
                        isFasting: true,
                        startTime: startTime.toISOString()
                    }));
                } else {
                    localStorage.removeItem('jitimer_state');
                }
            }, [isFasting, startTime]);

            // Persist Config
            useEffect(() => {
                localStorage.setItem('jitimer_config', JSON.stringify({
                    targetHours,
                    protocolLabel
                }));
            }, [targetHours, protocolLabel]);

            // Persist History
            useEffect(() => {
                localStorage.setItem('jitimer_history', JSON.stringify(history));
            }, [history]);

            // Update endTime if targetHours changes while fasting
            useEffect(() => {
                if (isFasting && startTime) {
                    const newEndTime = new Date(startTime.getTime() + goalSeconds * 1000);
                    setEndTime(newEndTime);
                }
            }, [targetHours, isFasting, startTime]);

            // Handlers
            const handleStart = () => {
                const now = new Date();
                setStartTime(now);
                setEndTime(new Date(now.getTime() + goalSeconds * 1000));
                setIsFasting(true);
                setElapsed(0);
            };

            const handleStopClick = () => {
                if (!startTime) return;
                
                // Open modal to confirm end time instead of direct alert
                setEditMode('end');
                const now = new Date();
                setEditTimeValue(formatTime(now));
                setEditDateValue(formatDateForInput(now));
                setIsEditTimeOpen(true);
            };

            const deleteRecord = (id) => {
                if(window.confirm("Tem certeza que deseja apagar este registro?")) {
                    setHistory(prev => prev.filter(r => r.id !== id));
                }
            };

            const handleEditStart = () => {
                if (!isFasting || !startTime) return;
                setEditMode('start');
                setEditTimeValue(formatTime(startTime));
                setEditDateValue(formatDateForInput(startTime));
                setIsEditTimeOpen(true);
            };

            const saveEditedTime = () => {
                if (!editTimeValue || !editDateValue) return;

                const [hours, minutes] = editTimeValue.split(':').map(Number);
                const [year, month, day] = editDateValue.split('-').map(Number);

                if (!isNaN(hours) && !isNaN(minutes) && !isNaN(year)) {
                    const selectedDate = new Date(year, month - 1, day, hours, minutes);

                    if (editMode === 'start') {
                        // Logic for Editing Start Time
                        setStartTime(selectedDate);
                        setEndTime(new Date(selectedDate.getTime() + goalSeconds * 1000));
                        const now = new Date();
                        setElapsed(Math.floor((now.getTime() - selectedDate.getTime()) / 1000));
                    } else {
                        // Logic for Ending Fast (Saving to History)
                        if (selectedDate < startTime) {
                            alert("A data de t√©rmino n√£o pode ser anterior ao in√≠cio.");
                            return;
                        }

                        const finalDuration = Math.floor((selectedDate.getTime() - startTime.getTime()) / 1000);
                        
                        const newRecord = {
                            id: crypto.randomUUID(),
                            startTime: startTime.toISOString(),
                            endTime: selectedDate.toISOString(),
                            durationSeconds: finalDuration,
                            protocol: protocolLabel,
                            targetHours: targetHours,
                            completed: finalDuration >= goalSeconds
                        };

                        setHistory(prev => [newRecord, ...prev]);

                        // Reset Timer
                        setIsFasting(false);
                        setStartTime(null);
                        setEndTime(null);
                        setElapsed(0);
                    }
                    
                    setIsEditTimeOpen(false);
                }
            };

            const selectProtocol = (label, hours) => {
                setProtocolLabel(label);
                setTargetHours(hours);
                setIsSettingsOpen(false);
            };

            // --- EXPORT & IMPORT HANDLERS ---
            const handleExport = () => {
                const data = {
                    state: localStorage.getItem('jitimer_state'),
                    config: localStorage.getItem('jitimer_config'),
                    history: localStorage.getItem('jitimer_history')
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `jitimer_backup_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const handleImport = (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = e.target?.result;
                        const data = JSON.parse(content);
                        
                        // Validate and Update LocalStorage
                        if (data.history) localStorage.setItem('jitimer_history', data.history);
                        if (data.config) localStorage.setItem('jitimer_config', data.config);
                        if (data.state) localStorage.setItem('jitimer_state', data.state);

                        // Update State directly to reflect changes immediately
                        if (data.history) {
                            setHistory(JSON.parse(data.history));
                        }

                        if (data.config) {
                            const cfg = JSON.parse(data.config);
                            if (cfg.targetHours) setTargetHours(cfg.targetHours);
                            if (cfg.protocolLabel) setProtocolLabel(cfg.protocolLabel);
                        }

                        if (data.state) {
                            const st = JSON.parse(data.state);
                            if (st && st.isFasting && st.startTime) {
                                setIsFasting(true);
                                const start = new Date(st.startTime);
                                setStartTime(start);
                                
                                // Recalculate based on current config (or imported config)
                                const cfgTarget = data.config ? JSON.parse(data.config).targetHours : targetHours;
                                const cfgGoalSeconds = cfgTarget * 3600;
                                
                                setEndTime(new Date(start.getTime() + cfgGoalSeconds * 1000));
                                
                                const now = new Date();
                                setElapsed(Math.floor((now.getTime() - start.getTime()) / 1000));
                            } else {
                                setIsFasting(false);
                                setStartTime(null);
                                setEndTime(null);
                                setElapsed(0);
                            }
                        }

                        alert('Dados importados com sucesso!');
                    } catch (err) {
                        console.error(err);
                        alert('Erro ao importar arquivo. Verifique se √© um backup v√°lido do JITimer.');
                    } finally {
                        if (fileInputRef.current) {
                            fileInputRef.current.value = '';
                        }
                    }
                };
                reader.readAsText(file);
            };

            const progress = calculateProgress(elapsed, goalSeconds);
            const remaining = Math.max(0, goalSeconds - elapsed);
            const isGoalReached = elapsed >= goalSeconds;

            return (
                <div className="min-h-screen bg-neutral-900 text-white font-sans selection:bg-green-500 selection:text-black flex flex-col items-center relative overflow-hidden">
                    
                    {/* Background Ambient Glow */}
                    <div className={`absolute top-[-20%] left-[-20%] w-[140%] h-[80%] rounded-full opacity-10 blur-3xl pointer-events-none transition-colors duration-1000 ${isFasting ? 'bg-green-900' : 'bg-orange-900'}`} />

                    {/* Header */}
                    <header className="w-full max-w-md p-6 flex justify-between items-center z-10">
                        <div className="flex items-center gap-2">
                            <div className={`w-2 h-2 rounded-full ${isFasting ? 'bg-green-500 animate-pulse' : 'bg-neutral-500'}`} />
                            <span className="font-semibold tracking-wide">JITimer</span>
                        </div>
                        
                        <div className="flex items-center gap-2">
                            {/* Import Button */}
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                onChange={handleImport} 
                                className="hidden" 
                                accept=".json"
                            />
                            <button 
                                onClick={() => fileInputRef.current?.click()}
                                className="p-2 rounded-full hover:bg-neutral-800 transition-colors text-neutral-400"
                                title="Importar Backup"
                            >
                                <Upload size={20} />
                            </button>

                            {/* Export Button */}
                            <button 
                                onClick={handleExport}
                                className="p-2 rounded-full hover:bg-neutral-800 transition-colors text-neutral-400"
                                title="Exportar Backup"
                            >
                                <Download size={20} />
                            </button>

                            {/* Settings Button */}
                            <button 
                                onClick={() => setIsSettingsOpen(true)}
                                className="p-2 rounded-full hover:bg-neutral-800 transition-colors text-neutral-400"
                                title="Configura√ß√µes"
                            >
                                <Settings size={20} />
                            </button>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 w-full max-w-md flex flex-col items-center justify-center p-6 z-10 gap-8">
                        
                        {/* Status Chip */}
                        <div className={`px-4 py-1.5 rounded-full text-sm font-medium tracking-wide flex items-center gap-2 transition-colors duration-500 ${isFasting ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-neutral-800 text-neutral-400 border border-neutral-700'}`}>
                            {isFasting ? (
                                isGoalReached ? 'Objetivo Alcan√ßado üéâ' : 'Voc√™ est√° jejuando'
                            ) : (
                                'Pronto para jejuar?'
                            )}
                        </div>

                        {/* The Circular Timer Component */}
                        <div className="relative">
                            <CircularProgress 
                                progress={isFasting ? progress : 0} 
                                isActive={isFasting}
                                size={300}
                                strokeWidth={10}
                            >
                                <div className="flex flex-col items-center text-center">
                                    <span className="text-neutral-400 text-sm font-medium mb-1">
                                        {isFasting ? 'Tempo decorrido' : `Protocolo ${protocolLabel}`}
                                    </span>
                                    <div className="text-5xl font-bold tabular-nums tracking-tight my-2">
                                        {isFasting ? formatDuration(elapsed) : `${targetHours}:00`}
                                    </div>
                                    
                                    {isFasting && (
                                        <div className="flex items-center gap-2 text-sm text-neutral-500 mt-2">
                                            {protocolLabel === 'Livre' ? (
                                                <span>Modo Livre</span>
                                            ) : (
                                                <span>Faltam {formatDuration(remaining)}</span>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </CircularProgress>
                        </div>

                        {/* Start/End Times Row */}
                        <div className="grid grid-cols-2 w-full gap-4 mt-4">
                            <div className="bg-neutral-800/50 backdrop-blur-sm rounded-2xl p-4 flex flex-col items-center justify-center border border-neutral-800">
                                <span className="text-neutral-500 text-xs mb-1">Iniciou</span>
                                <div className="flex items-center gap-2">
                                    <div className="flex flex-col items-end">
                                        <span className="text-xl font-medium text-neutral-200 leading-none">
                                            {startTime ? formatTime(startTime) : '--:--'}
                                        </span>
                                        {startTime && <span className="text-[10px] text-neutral-500">{formatDate(startTime)}</span>}
                                    </div>
                                    {isFasting && (
                                        <button 
                                            onClick={handleEditStart}
                                            className="text-neutral-600 hover:text-green-400 transition-colors p-1"
                                            title="Editar hor√°rio e data de in√≠cio"
                                        >
                                            <Edit2 size={14} />
                                        </button>
                                    )}
                                </div>
                            </div>
                            <div className="bg-neutral-800/50 backdrop-blur-sm rounded-2xl p-4 flex flex-col items-center justify-center border border-neutral-800">
                                <span className="text-neutral-500 text-xs mb-1">Termina</span>
                                <div className="flex flex-col items-center">
                                    <span className="text-xl font-medium text-neutral-200 leading-none">
                                        {endTime && protocolLabel !== 'Livre' ? formatTime(endTime) : '--:--'}
                                    </span>
                                    {endTime && protocolLabel !== 'Livre' && (
                                        <span className="text-[10px] text-neutral-500">{formatDate(endTime)}</span>
                                    )}
                                    {protocolLabel === 'Livre' && <span className="text-xl font-medium text-neutral-600">--:--</span>}
                                </div>
                            </div>
                        </div>

                        {/* Main Action Button */}
                        <div className="w-full mt-2">
                            {!isFasting ? (
                                <button 
                                    onClick={handleStart}
                                    className="w-full bg-green-500 hover:bg-green-400 text-black font-bold py-4 rounded-2xl shadow-[0_0_20px_rgba(34,197,94,0.3)] transition-all active:scale-[0.98] flex items-center justify-center gap-2 text-lg"
                                >
                                    <Play fill="currentColor" size={20} />
                                    Iniciar Jejum
                                </button>
                            ) : (
                                <button 
                                    onClick={handleStopClick}
                                    className="w-full bg-neutral-800 hover:bg-neutral-700 text-red-400 hover:text-red-300 font-bold py-4 rounded-2xl border border-neutral-700 transition-all active:scale-[0.98] flex items-center justify-center gap-2 text-lg"
                                >
                                    <Square fill="currentColor" size={20} />
                                    Encerrar Jejum
                                </button>
                            )}
                        </div>

                    </main>

                    {/* Footer / Stats Teaser */}
                    <footer className="w-full max-w-md p-6 pb-8 z-10">
                        <button 
                            onClick={() => setIsHistoryOpen(true)}
                            className="w-full bg-neutral-800/30 rounded-xl p-4 flex items-center justify-between cursor-pointer hover:bg-neutral-800/50 transition-colors border border-transparent hover:border-neutral-700"
                        >
                            <div className="flex items-center gap-3">
                                <div className="bg-neutral-800 p-2 rounded-lg text-green-500">
                                    <HistoryIcon size={20} />
                                </div>
                                <div className="flex flex-col items-start">
                                    <span className="text-sm font-medium text-neutral-200">Hist√≥rico de Jejuns</span>
                                    <span className="text-xs text-neutral-500">
                                        {history.length} {history.length === 1 ? 'registro salvo' : 'registros salvos'}
                                    </span>
                                </div>
                            </div>
                            <ChevronRight className="text-neutral-600" size={20} />
                        </button>
                    </footer>

                    {/* Settings Modal */}
                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200">
                            <div className="bg-neutral-900 w-full max-w-sm rounded-3xl border border-neutral-800 shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300">
                                <div className="p-6 border-b border-neutral-800 flex justify-between items-center">
                                    <h2 className="text-xl font-bold text-white">Protocolo de Jejum</h2>
                                    <button onClick={() => setIsSettingsOpen(false)} className="text-neutral-400 hover:text-white">
                                        <X size={24} />
                                    </button>
                                </div>
                                <div className="p-4 flex flex-col gap-2">
                                    {[
                                        { label: '16:8', desc: 'Iniciante - 16h jejum, 8h alimenta√ß√£o', hours: 16 },
                                        { label: '18:6', desc: 'Intermedi√°rio - 18h jejum, 6h alimenta√ß√£o', hours: 18 },
                                        { label: '24:0', desc: 'Guerreiro - 24h jejum completo', hours: 24 },
                                        { label: 'Livre', desc: 'Flex√≠vel - Sem meta fixa definida', hours: 12 }
                                    ].map((proto) => (
                                        <button
                                            key={proto.label}
                                            onClick={() => selectProtocol(proto.label, proto.hours)}
                                            className={`w-full p-4 rounded-xl flex items-center justify-between transition-all ${
                                                protocolLabel === proto.label 
                                                ? 'bg-green-500/10 border border-green-500/50 text-green-400' 
                                                : 'bg-neutral-800/50 border border-neutral-800 text-neutral-300 hover:bg-neutral-800'
                                            }`}
                                        >
                                            <div className="flex flex-col items-start">
                                                <span className="font-bold text-lg">{proto.label}</span>
                                                <span className="text-xs opacity-70">{proto.desc}</span>
                                            </div>
                                            {protocolLabel === proto.label && <Check size={20} />}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Time / End Fast Modal */}
                    {isEditTimeOpen && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200">
                            <div className="bg-neutral-900 w-full max-w-sm rounded-3xl border border-neutral-800 shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300">
                                <div className="p-6 border-b border-neutral-800 flex justify-between items-center">
                                    <h2 className="text-xl font-bold text-white">
                                        {editMode === 'start' ? 'Editar In√≠cio' : 'Encerrar Jejum'}
                                    </h2>
                                    <button onClick={() => setIsEditTimeOpen(false)} className="text-neutral-400 hover:text-white">
                                        <X size={24} />
                                    </button>
                                </div>
                                <div className="p-6 flex flex-col gap-4">
                                    <div className="text-sm text-neutral-500 mb-[-10px]">
                                        {editMode === 'start' ? 'Iniciou em:' : 'Terminou em:'}
                                    </div>
                                    <div className="bg-neutral-800 p-4 rounded-2xl flex items-center gap-4 w-full border border-neutral-700">
                                        <Calendar className="text-neutral-400" size={24} />
                                        <input 
                                            type="date" 
                                            value={editDateValue}
                                            onChange={(e) => setEditDateValue(e.target.value)}
                                            className="bg-transparent text-lg font-medium text-white focus:outline-none w-full"
                                        />
                                    </div>
                                    <div className="bg-neutral-800 p-4 rounded-2xl flex items-center gap-4 w-full border border-neutral-700">
                                        <Clock className={editMode === 'start' ? "text-green-500" : "text-red-500"} size={24} />
                                        <input 
                                            type="time" 
                                            value={editTimeValue}
                                            onChange={(e) => setEditTimeValue(e.target.value)}
                                            className="bg-transparent text-3xl font-bold text-white focus:outline-none font-mono w-full"
                                        />
                                    </div>
                                    <div className="flex gap-3 w-full mt-2">
                                        <button 
                                            onClick={() => setIsEditTimeOpen(false)}
                                            className="flex-1 bg-neutral-800 text-neutral-300 py-3 rounded-xl font-medium hover:bg-neutral-700 transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                        <button 
                                            onClick={saveEditedTime}
                                            className={`flex-1 text-white py-3 rounded-xl font-bold transition-colors ${editMode === 'start' ? 'bg-green-600 hover:bg-green-500' : 'bg-red-600 hover:bg-red-500'}`}
                                        >
                                            {editMode === 'start' ? 'Salvar' : 'Confirmar'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* History Modal */}
                    {isHistoryOpen && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200">
                            <div className="bg-neutral-900 w-full max-w-md h-[80vh] flex flex-col rounded-t-3xl sm:rounded-3xl border border-neutral-800 shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300">
                                <div className="p-6 border-b border-neutral-800 flex justify-between items-center bg-neutral-900 z-10">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2">
                                        <HistoryIcon size={20} className="text-green-500"/>
                                        Hist√≥rico
                                    </h2>
                                    <button onClick={() => setIsHistoryOpen(false)} className="text-neutral-400 hover:text-white">
                                        <X size={24} />
                                    </button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-3">
                                    {history.length === 0 ? (
                                        <div className="flex flex-col items-center justify-center h-full text-neutral-500 space-y-2 opacity-50">
                                            <Clock size={48} />
                                            <span>Nenhum jejum registrado ainda.</span>
                                        </div>
                                    ) : (
                                        history.map((record) => (
                                            <div key={record.id} className="bg-neutral-800/50 rounded-xl p-4 flex items-center justify-between border border-neutral-800">
                                                <div className="flex flex-col gap-1">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-white font-medium">
                                                            {new Date(record.startTime).toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: 'short' })}
                                                        </span>
                                                        <span className={`text-[10px] px-1.5 py-0.5 rounded border ${record.completed ? 'bg-green-900/30 border-green-800 text-green-400' : 'bg-red-900/30 border-red-800 text-red-400'}`}>
                                                            {record.protocol}
                                                        </span>
                                                    </div>
                                                    <span className="text-xs text-neutral-400">
                                                        {formatTime(new Date(record.startTime))} - {formatTime(new Date(record.endTime))}
                                                    </span>
                                                </div>
                                                <div className="flex items-center gap-4">
                                                    <span className="text-lg font-bold tabular-nums text-neutral-200">
                                                        {formatDuration(record.durationSeconds)}
                                                    </span>
                                                    <button 
                                                        onClick={() => deleteRecord(record.id)}
                                                        className="text-neutral-600 hover:text-red-400 transition-colors p-1"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<JITimer />);
    </script>
</body>
</html>